<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>tld3</title>
  <script src='https://cdn.firebase.com/js/client/2.2.1/firebase.js'></script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.2.0/Chart.js'></script>
  <script src="http://code.jquery.com/jquery-1.11.2.min.js"></script>
</head>
<body>


  <canvas id="myChart_1" width="740" height="200"></canvas>
  <canvas id="myChart_2" width="740" height="200"></canvas>
  <canvas id="myChart_3" width="740" height="200"></canvas>
  <canvas id="myChart_4" width="740" height="200"></canvas>
  <canvas id="myChart_5" width="740" height="200"></canvas>

  <script>
  var jsonext;

  var myTimer = setInterval(drawLineChart,5000);
  function drawLineChart() {

    // Add a helper to format timestamp data
    // Date.prototype.formatMMDDYYYY = function() {
    //   return (this.getMonth() + 1) +
    //   "/" +  this.getDate() +
    //   "/" +  this.getFullYear();
    // }

    var jsonData = $.ajax({
      url: 'https://group9-node.firebaseio.com/temperatures.json',
      dataType: 'json',
    }).done(function (results) {

      console.log(results);
      jsonext = results;
      // Split timestamp and data into separate arrays
      var labels = {}, data = {};
      for(device in results){
        let myDevice = [];
        let myData = [];
        for (templog in results[device]){
          myDevice.push(new Date(templog));
          myData.push(parseFloat(results[device][templog]));
        }
        labels[device]= myDevice;
        data[device] = myData;

      }
      // console.log("labels: " + labels["1e0027001847353236343033"] )
      // console.log("data: " + data["1e0027001847353236343033"])
      // console.log("data: " + data["1b003b000a47353235303037"])
      // results.forEach(function(packet) {
      //   labels.push(new Date(packet.timestamp).formatMMDDYYYY());
      //   data.push(parseFloat(packet.payloadString));
      // });

      // Create the chart.js data structure using 'labels' and 'data'
      var counter = 1;
      for (key in labels){

        var tempData = {
          labels : labels[key],
          datasets : [{
            strokeColor           : "rgba(151,187,205,1)",
            pointColor            : "rgba(151,187,205,1)",
            pointStrokeColor      : "#fff",
            pointHighlightFill    : "#fff",
            pointHighlightStroke  : "rgba(151,187,205,1)",
            data                  : data[key]
          }]
        };


        // Get the context of the canvas element we want to select
        var Chartname = "myChart_" + counter;
        var ctx = document.getElementById(Chartname).getContext("2d");
        counter++;
        Chart.defaults.global.animation.duration = 0;
        // Instantiate a new chart
        var myLineChart = new Chart(ctx, {
            data: tempData,
            type: "line"
        });
      }

      //var myLineChart = new Chart(ctx).Line(tempData);

    }).fail(function(){
      console.log("Failed: " + jsonData)
    });

  }

  drawLineChart();
  </script>
</body>
</html>
